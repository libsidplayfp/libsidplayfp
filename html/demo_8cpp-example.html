<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libsidplayfp: demo.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libsidplayfp
   &#160;<span id="projectnumber">2.1.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">demo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * This file is part of libsidplayfp, a SID player engine.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright 2012-2014 Leandro Nini &lt;drfiemost@users.sourceforge.net&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><span class="comment"> * (at your option) any later version.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/soundcard.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sidplayfp/sidplayfp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sidplayfp/SidTune.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sidplayfp/SidInfo.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sidplayfp/builders/residfp.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Adjust these paths to point to existing ROM dumps if needed.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define KERNAL_PATH  &quot;&quot;</span></div>
<div class="line"><span class="preprocessor">#define BASIC_PATH   &quot;&quot;</span></div>
<div class="line"><span class="preprocessor">#define CHARGEN_PATH &quot;&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SAMPLERATE 48000</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Load ROM dump from file.</span></div>
<div class="line"><span class="comment"> * Allocate the buffer if file exists, otherwise return 0.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">char</span>* loadRom(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">size_t</span> romSize)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>* buffer = 0;</div>
<div class="line">    std::ifstream is(path, std::ios::binary);</div>
<div class="line">    <span class="keywordflow">if</span> (is.good())</div>
<div class="line">    {</div>
<div class="line">        buffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[romSize];</div>
<div class="line">        is.read(buffer, romSize);</div>
<div class="line">    }</div>
<div class="line">    is.close();</div>
<div class="line">    <span class="keywordflow">return</span> buffer;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Sample application that shows how to use libsidplayfp</span></div>
<div class="line"><span class="comment"> * to play a SID tune from a file.</span></div>
<div class="line"><span class="comment"> * It uses OSS for audio output.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a name="_a0"></a><a class="code" href="classsidplayfp.html">sidplayfp</a> m_engine;</div>
<div class="line"> </div>
<div class="line">    { <span class="comment">// Load ROM files</span></div>
<div class="line">    <span class="keywordtype">char</span> *kernal = loadRom(KERNAL_PATH, 8192);</div>
<div class="line">    <span class="keywordtype">char</span> *basic = loadRom(BASIC_PATH, 8192);</div>
<div class="line">    <span class="keywordtype">char</span> *chargen = loadRom(CHARGEN_PATH, 4096);</div>
<div class="line"> </div>
<div class="line">    m_engine.<a name="a1"></a><a class="code" href="classsidplayfp.html#ac6a9155ee3af4bac3cd775d72db41f57">setRoms</a>((<span class="keyword">const</span> uint8_t*)kernal, (<span class="keyword">const</span> uint8_t*)basic, (<span class="keyword">const</span> uint8_t*)chargen);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">delete</span> [] kernal;</div>
<div class="line">    <span class="keyword">delete</span> [] basic;</div>
<div class="line">    <span class="keyword">delete</span> [] chargen;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set up a SID builder</span></div>
<div class="line">    std::auto_ptr&lt;ReSIDfpBuilder&gt; rs(<span class="keyword">new</span> <a name="_a2"></a><a class="code" href="classReSIDfpBuilder.html">ReSIDfpBuilder</a>(<span class="stringliteral">&quot;Demo&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get the number of SIDs supported by the engine</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxsids = (m_engine.<a name="a3"></a><a class="code" href="classsidplayfp.html#a1aea02da25db84d61604ebbb5af5f386">info</a> ()).maxsids();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create SID emulators</span></div>
<div class="line">    rs-&gt;create(maxsids);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if builder is ok</span></div>
<div class="line">    <span class="keywordflow">if</span> (!rs-&gt;getStatus())</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; rs-&gt;error() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Load tune from file</span></div>
<div class="line">    std::auto_ptr&lt;SidTune&gt; tune(<span class="keyword">new</span> <a name="_a4"></a><a class="code" href="classSidTune.html">SidTune</a>(argv[1]));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// CHeck if the tune is valid</span></div>
<div class="line">    <span class="keywordflow">if</span> (!tune-&gt;getStatus())</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; tune-&gt;statusString() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Select default song</span></div>
<div class="line">    tune-&gt;selectSong(0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configure the engine</span></div>
<div class="line">    <a name="_a5"></a><a class="code" href="classSidConfig.html">SidConfig</a> cfg;</div>
<div class="line">    cfg.<a name="a6"></a><a class="code" href="classSidConfig.html#a577c7513e60a83643d5164b9a4dbc091">frequency</a> = SAMPLERATE;</div>
<div class="line">    cfg.<a name="a7"></a><a class="code" href="classSidConfig.html#afb1f9401f74b5801c6f552b43cf16e50">samplingMethod</a> = SidConfig::INTERPOLATE;</div>
<div class="line">    cfg.<a name="a8"></a><a class="code" href="classSidConfig.html#a95b15cef0a5ded03a557d422b6752b9e">fastSampling</a> = <span class="keyword">false</span>;</div>
<div class="line">    cfg.<a name="a9"></a><a class="code" href="classSidConfig.html#a82de01986c9d346c0a5368069a6cfb2a">playback</a> = SidConfig::MONO;</div>
<div class="line">    cfg.<a name="a10"></a><a class="code" href="classSidConfig.html#adc60d41cde7aedb58d24cde2aeff92a0">sidEmulation</a> = rs.get();</div>
<div class="line">    <span class="keywordflow">if</span> (!m_engine.<a name="a11"></a><a class="code" href="classsidplayfp.html#a455797460b63290cddbeb99d3c24a056">config</a>(cfg))</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt;  m_engine.<a name="a12"></a><a class="code" href="classsidplayfp.html#a8ad05fe52bd34636832684c6c08ca994">error</a>() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Load tune into engine</span></div>
<div class="line">    <span class="keywordflow">if</span> (!m_engine.<a name="a13"></a><a class="code" href="classsidplayfp.html#a62e5a8e252685332f8a9ddbb6f466e14">load</a>(tune.get()))</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt;  m_engine.<a class="code" href="classsidplayfp.html#a8ad05fe52bd34636832684c6c08ca994">error</a>() &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup audio device</span></div>
<div class="line">    <span class="keywordtype">int</span> handle=::open(<span class="stringliteral">&quot;/dev/dsp&quot;</span>, O_WRONLY, 0);</div>
<div class="line">    <span class="keywordtype">int</span> format=AFMT_S16_LE;</div>
<div class="line">    ioctl(handle, SNDCTL_DSP_SETFMT, &amp;format);</div>
<div class="line">    <span class="keywordtype">int</span> chn=1;</div>
<div class="line">    ioctl(handle, SNDCTL_DSP_CHANNELS, &amp;chn);</div>
<div class="line">    <span class="keywordtype">int</span> sampleRate=SAMPLERATE;</div>
<div class="line">    ioctl(handle, SNDCTL_DSP_SPEED, &amp;sampleRate);</div>
<div class="line">    <span class="keywordtype">int</span> bufferSize;</div>
<div class="line">    ioctl(handle, SNDCTL_DSP_GETBLKSIZE, &amp;bufferSize);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> bufferSamples = bufferSize / <span class="keyword">sizeof</span>(short);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Play</span></div>
<div class="line">    std::vector&lt;short&gt; buffer(bufferSamples);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;1000; i++)</div>
<div class="line">    {</div>
<div class="line">        m_engine.<a name="a14"></a><a class="code" href="classsidplayfp.html#ac436fcda23b37c6fb03e319d9705947b">play</a>(&amp;buffer.front(), bufferSamples);</div>
<div class="line">        ::write(handle, &amp;buffer.front(), bufferSize);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ::close(handle);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aclasssidplayfp_html_a62e5a8e252685332f8a9ddbb6f466e14"><div class="ttname"><a href="classsidplayfp.html#a62e5a8e252685332f8a9ddbb6f466e14">sidplayfp::load</a></div><div class="ttdeci">bool load(SidTune *tune)</div><div class="ttdef"><b>Definition:</b> sidplayfp.cpp:64</div></div>
<div class="ttc" id="aclasssidplayfp_html_ac6a9155ee3af4bac3cd775d72db41f57"><div class="ttname"><a href="classsidplayfp.html#ac6a9155ee3af4bac3cd775d72db41f57">sidplayfp::setRoms</a></div><div class="ttdeci">void setRoms(const uint8_t *kernal, const uint8_t *basic=0, const uint8_t *character=0)</div><div class="ttdef"><b>Definition:</b> sidplayfp.cpp:109</div></div>
<div class="ttc" id="aclassSidTune_html"><div class="ttname"><a href="classSidTune.html">SidTune</a></div><div class="ttdef"><b>Definition:</b> SidTune.h:41</div></div>
<div class="ttc" id="aclasssidplayfp_html"><div class="ttname"><a href="classsidplayfp.html">sidplayfp</a></div><div class="ttdef"><b>Definition:</b> sidplayfp.h:46</div></div>
<div class="ttc" id="aclasssidplayfp_html_a1aea02da25db84d61604ebbb5af5f386"><div class="ttname"><a href="classsidplayfp.html#a1aea02da25db84d61604ebbb5af5f386">sidplayfp::info</a></div><div class="ttdeci">const SidInfo &amp; info() const</div><div class="ttdef"><b>Definition:</b> sidplayfp.cpp:69</div></div>
<div class="ttc" id="aclassSidConfig_html_a82de01986c9d346c0a5368069a6cfb2a"><div class="ttname"><a href="classSidConfig.html#a82de01986c9d346c0a5368069a6cfb2a">SidConfig::playback</a></div><div class="ttdeci">playback_t playback</div><div class="ttdef"><b>Definition:</b> SidConfig.h:136</div></div>
<div class="ttc" id="aclassSidConfig_html"><div class="ttname"><a href="classSidConfig.html">SidConfig</a></div><div class="ttdef"><b>Definition:</b> SidConfig.h:39</div></div>
<div class="ttc" id="aclassSidConfig_html_adc60d41cde7aedb58d24cde2aeff92a0"><div class="ttname"><a href="classSidConfig.html#adc60d41cde7aedb58d24cde2aeff92a0">SidConfig::sidEmulation</a></div><div class="ttdeci">sidbuilder * sidEmulation</div><div class="ttdef"><b>Definition:</b> SidConfig.h:155</div></div>
<div class="ttc" id="aclassReSIDfpBuilder_html"><div class="ttname"><a href="classReSIDfpBuilder.html">ReSIDfpBuilder</a></div><div class="ttdef"><b>Definition:</b> residfp.h:32</div></div>
<div class="ttc" id="aclasssidplayfp_html_a455797460b63290cddbeb99d3c24a056"><div class="ttname"><a href="classsidplayfp.html#a455797460b63290cddbeb99d3c24a056">sidplayfp::config</a></div><div class="ttdeci">const SidConfig &amp; config() const</div><div class="ttdef"><b>Definition:</b> sidplayfp.cpp:49</div></div>
<div class="ttc" id="aclasssidplayfp_html_ac436fcda23b37c6fb03e319d9705947b"><div class="ttname"><a href="classsidplayfp.html#ac436fcda23b37c6fb03e319d9705947b">sidplayfp::play</a></div><div class="ttdeci">uint_least32_t play(short *buffer, uint_least32_t count)</div><div class="ttdef"><b>Definition:</b> sidplayfp.cpp:59</div></div>
<div class="ttc" id="aclassSidConfig_html_afb1f9401f74b5801c6f552b43cf16e50"><div class="ttname"><a href="classSidConfig.html#afb1f9401f74b5801c6f552b43cf16e50">SidConfig::samplingMethod</a></div><div class="ttdeci">sampling_method_t samplingMethod</div><div class="ttdef"><b>Definition:</b> SidConfig.h:177</div></div>
<div class="ttc" id="aclassSidConfig_html_a577c7513e60a83643d5164b9a4dbc091"><div class="ttname"><a href="classSidConfig.html#a577c7513e60a83643d5164b9a4dbc091">SidConfig::frequency</a></div><div class="ttdeci">uint_least32_t frequency</div><div class="ttdef"><b>Definition:</b> SidConfig.h:141</div></div>
<div class="ttc" id="aclasssidplayfp_html_a8ad05fe52bd34636832684c6c08ca994"><div class="ttname"><a href="classsidplayfp.html#a8ad05fe52bd34636832684c6c08ca994">sidplayfp::error</a></div><div class="ttdeci">const char * error() const</div><div class="ttdef"><b>Definition:</b> sidplayfp.cpp:84</div></div>
<div class="ttc" id="aclassSidConfig_html_a95b15cef0a5ded03a557d422b6752b9e"><div class="ttname"><a href="classSidConfig.html#a95b15cef0a5ded03a557d422b6752b9e">SidConfig::fastSampling</a></div><div class="ttdeci">bool fastSampling</div><div class="ttdef"><b>Definition:</b> SidConfig.h:183</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 19 2021 18:39:43 for libsidplayfp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
